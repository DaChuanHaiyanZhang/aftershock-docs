import{_ as i,c as a,o as t,a5 as n}from"./chunks/framework.BOSSiFom.js";const g=JSON.parse('{"title":"instant.one 集成指南","description":"","frontmatter":{},"headers":[],"relativePath":"plugins/instant-one.md","filePath":"plugins/instant-one.md"}'),l={name:"plugins/instant-one.md"};function e(h,s,p,k,d,E){return t(),a("div",null,[...s[0]||(s[0]=[n(`<h1 id="instant-one-集成指南" tabindex="-1">instant.one 集成指南 <a class="header-anchor" href="#instant-one-集成指南" aria-label="Permalink to “instant.one 集成指南”">​</a></h1><nav class="table-of-contents"><ul><li><a href="#概述">概述</a></li><li><a href="#核心流程与技术细节">核心流程与技术细节</a></li><li><a href="#事件跟踪核心概念">事件跟踪核心概念</a></li><li><a href="#可用事件速览">可用事件速览</a></li><li><a href="#事件详情与集成指南">事件详情与集成指南</a><ul><li><a href="#page-viewed">PAGE_VIEWED</a></li><li><a href="#product-viewed">PRODUCT_VIEWED</a></li><li><a href="#item-added-to-cart">ITEM_ADDED_TO_CART</a></li><li><a href="#cart-viewed">CART_VIEWED</a></li><li><a href="#checkout-started">CHECKOUT_STARTED</a></li><li><a href="#collection-viewed">COLLECTION_VIEWED</a></li></ul></li><li><a href="#实施与测试建议">实施与测试建议</a></li><li><a href="#通用-typescript-类型参考">通用 TypeScript 类型参考</a></li></ul></nav><h2 id="概述" tabindex="-1">概述 <a class="header-anchor" href="#概述" aria-label="Permalink to “概述”">​</a></h2><p><code>Instant.one</code> 通过跟踪用户在 <code>Aftershock</code> 商城中的实时行为（如浏览、加购），并利用AI分析这些数据，从而自动向用户推送高度个性化的营销邮件，以提升互动与转化。</p><p><code>Klaviyo</code> 通过追踪用户在 <code>Aftershock</code> 商城中的行为与交易数据，并利用其营销自动化平台，为用户自动发送高度个性化的邮件、短信等多渠道信息，以培育客户关系并促进复购。</p><p>如何集成请查看官方文档。</p><div class="important custom-block github-alert"><p class="custom-block-title">IMPORTANT</p><p>官方链接地址: <a href="https://help.instant.one/installing-instant-ai-for-headless-shopify-sites" target="_blank" rel="noreferrer">https://help.instant.one/installing-instant-ai-for-headless-shopify-sites</a></p></div><h2 id="核心流程与技术细节" tabindex="-1">核心流程与技术细节 <a class="header-anchor" href="#核心流程与技术细节" aria-label="Permalink to “核心流程与技术细节”">​</a></h2><p>整个集成流程围绕数据流转展开，具体技术实现如下：</p><ol><li><p>事件触发与采集 当用户在 Aftershock 商城浏览、查看商品或加购时，在网站代码中调用 window.InstantJS.track() 方法。这是整个数据流的起点。</p></li><li><p>数据处理与同步 Instant.one 的 SDK 会捕获这些事件。其关键在于，Instant.one 不仅能转发原始数据，还能利用其AI能力对数据进行丰富和上下文分析（例如，判断用户意图），然后将标准化的用户行为事件实时同步到 Klaviyo 平台。这通常通过 Klaviyo 的 API 完成。</p></li><li><p>营销自动化触发 在 Klaviyo 后台，这些由 Instant.one 同步过来的事件（如 Product Viewed、Added to Cart）会与具体的用户档案（Profile）关联。可以基于这些事件创建或触发对应的自动化流程（Flow）。</p></li></ol><h2 id="事件跟踪核心概念" tabindex="-1">事件跟踪核心概念 <a class="header-anchor" href="#事件跟踪核心概念" aria-label="Permalink to “事件跟踪核心概念”">​</a></h2><p>在开始集成前，了解 Instant 事件跟踪的三个核心对象会很有帮助：</p><ul><li><strong><code>products</code></strong>: 描述被浏览的商品，用于 <code>PAGE_VIEWED</code>, <code>COLLECTION_VIEWED</code>, <code>PRODUCT_VIEWED</code>。</li><li><strong><code>cart</code></strong>: 描述购物车的完整状态，用于 <code>CART_VIEWED</code>, <code>CHECKOUT_STARTED</code>。</li><li><strong><code>items</code></strong>: 描述购物车中变动的商品项，与 <code>cart</code> 搭配用于 <code>ITEM_ADDED_TO_CART</code>。</li></ul><p>所有事件都通过全局的 <code>window.InstantJS.track()</code> 方法发送。您可以同时发送给 Instant 和其他服务商（如 Klaviyo）。</p><hr><h2 id="可用事件速览" tabindex="-1">可用事件速览 <a class="header-anchor" href="#可用事件速览" aria-label="Permalink to “可用事件速览”">​</a></h2><p>下表列出了所有需要跟踪的事件及其核心用途，方便您快速了解。每个事件的具体参数和示例请参阅后续的详细章节。</p><table tabindex="0"><thead><tr><th style="text-align:left;">事件类型</th><th style="text-align:left;">触发时机</th><th style="text-align:left;">必需参数</th><th style="text-align:left;">核心目的</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>PAGE_VIEWED</strong></td><td style="text-align:left;">用户浏览任何页面时</td><td style="text-align:left;"><code>products</code></td><td style="text-align:left;">记录页面关联的商品曝光，用于个性化推荐。</td></tr><tr><td style="text-align:left;"><strong>PRODUCT_VIEWED</strong></td><td style="text-align:left;">用户查看商品详情页时</td><td style="text-align:left;"><code>products</code></td><td style="text-align:left;">追踪具体的商品浏览行为，分析用户兴趣。</td></tr><tr><td style="text-align:left;"><strong>ITEM_ADDED_TO_CART</strong></td><td style="text-align:left;">商品被加入购物车时</td><td style="text-align:left;"><code>cart</code>, <code>items</code></td><td style="text-align:left;">捕获加购行为，用于弃购挽回和购物车推荐。</td></tr><tr><td style="text-align:left;"><strong>CART_VIEWED</strong></td><td style="text-align:left;">用户打开购物车页面时</td><td style="text-align:left;"><code>cart</code></td><td style="text-align:left;">记录用户主动查看购物车的行为。</td></tr><tr><td style="text-align:left;"><strong>CHECKOUT_STARTED</strong></td><td style="text-align:left;">用户进入结算流程时</td><td style="text-align:left;"><code>cart</code></td><td style="text-align:left;">标识关键的转化节点，用于优化结算流程。</td></tr><tr><td style="text-align:left;"><strong>COLLECTION_VIEWED</strong></td><td style="text-align:left;">用户浏览商品分类/集合页时</td><td style="text-align:left;"><code>products</code></td><td style="text-align:left;">了解用户对商品类别的偏好。</td></tr></tbody></table><hr><h2 id="事件详情与集成指南" tabindex="-1">事件详情与集成指南 <a class="header-anchor" href="#事件详情与集成指南" aria-label="Permalink to “事件详情与集成指南”">​</a></h2><p>以下是对每个事件的详细说明、示例代码和参数列表。</p><h3 id="page-viewed" tabindex="-1">PAGE_VIEWED <a class="header-anchor" href="#page-viewed" aria-label="Permalink to “PAGE_VIEWED”">​</a></h3><p>当用户浏览任何页面时触发。您可以在页面加载时，发送当前页面相关的商品信息，帮助 Instant AI 了解上下文并提供个性化推荐。</p><p><strong>TypeScript 函数示例</strong></p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 示例：在网站全局布局或页面组件中调用</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> trackPageView</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">pageProducts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> InteractionProduct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[])</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> eventPayloads</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> InstantEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      provider: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;INSTANT&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      event: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        products: pageProducts </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 传入当前页面希望关联的商品数组</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (window.InstantJS) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    window.InstantJS.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">track</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;PAGE_VIEWED&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, eventPayloads);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">warn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;InstantJS 未加载&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 使用示例：在商品列表页，传入前3个商品</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// const productsOnPage = [...];</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// trackPageView(productsOnPage.slice(0, 3));</span></span></code></pre></div><p><strong>事件载荷示例</strong></p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">window.InstantJS?.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">track</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;PAGE_VIEWED&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    provider: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;INSTANT&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    event: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      products: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          product_id: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;prod_123&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          product_sku: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;TSHIRT-WHITE-M&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          product_name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;纯棉白色T恤（M码）&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          price: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2999</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          currency: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CNY&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          image: { url: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://cdn.example.com/tshirt-white.jpg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          online_store_url: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://shop.example.com/product/tshirt-white&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 重要</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]);</span></span></code></pre></div><p><strong><code>products</code> 参数说明 (InteractionProduct)</strong></p><table tabindex="0"><thead><tr><th style="text-align:left;">参数名</th><th style="text-align:left;">类型</th><th style="text-align:left;">是否必需</th><th style="text-align:left;">说明与示例</th></tr></thead><tbody><tr><td style="text-align:left;"><strong><code>product_id</code></strong></td><td style="text-align:left;"><code>string</code></td><td style="text-align:left;"><strong>是</strong></td><td style="text-align:left;">商品唯一ID。<code>&quot;prod_12345&quot;</code></td></tr><tr><td style="text-align:left;"><strong><code>product_sku</code></strong></td><td style="text-align:left;"><code>string</code></td><td style="text-align:left;"><strong>是</strong></td><td style="text-align:left;">商品SKU。<code>&quot;BLANKET-SMALL&quot;</code></td></tr><tr><td style="text-align:left;"><strong><code>product_name</code></strong></td><td style="text-align:left;"><code>string</code></td><td style="text-align:left;"><strong>是</strong></td><td style="text-align:left;">商品名称。<code>&quot;法兰绒毯子&quot;</code></td></tr><tr><td style="text-align:left;"><strong><code>image</code></strong></td><td style="text-align:left;"><code>object</code></td><td style="text-align:left;"><strong>是</strong></td><td style="text-align:left;">主图对象，必须含 <code>url</code>。<code>{url: ‘https://...’}</code></td></tr><tr><td style="text-align:left;"><code>online_store_url</code></td><td style="text-align:left;"><code>string</code></td><td style="text-align:left;"><strong>强烈建议</strong></td><td style="text-align:left;">商品页链接。有助于生成正确链接。</td></tr><tr><td style="text-align:left;"><code>price</code></td><td style="text-align:left;"><code>number</code></td><td style="text-align:left;">否</td><td style="text-align:left;">价格（单位：分）。<code>8900</code> 表示89.00元</td></tr><tr><td style="text-align:left;"><code>currency</code></td><td style="text-align:left;"><code>string</code></td><td style="text-align:left;">否</td><td style="text-align:left;">货币代码。<code>&quot;CNY&quot;</code>, <code>&quot;USD&quot;</code></td></tr><tr><td style="text-align:left;"><code>variant_id</code></td><td style="text-align:left;"><code>string</code></td><td style="text-align:left;">否</td><td style="text-align:left;">变体ID。<code>&quot;var_678&quot;</code></td></tr></tbody></table><h3 id="product-viewed" tabindex="-1">PRODUCT_VIEWED <a class="header-anchor" href="#product-viewed" aria-label="Permalink to “PRODUCT_VIEWED”">​</a></h3><p>当用户查看单个商品的详情页时触发。这是理解用户兴趣的最关键事件之一。</p><p><strong>TypeScript 函数示例</strong></p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> trackProductView</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">product</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> InteractionProduct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 注意：products 属性应是一个数组，即使只包含一个商品</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> eventPayloads</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> InstantEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      provider: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;INSTANT&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      event: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        products: [product] </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  window.InstantJS?.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">track</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;PRODUCT_VIEWED&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, eventPayloads);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 使用示例：在商品详情页的React组件或Vue的mounted钩子中调用</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// useEffect(() =&gt; { trackProductView(currentProduct); }, [currentProduct]);</span></span></code></pre></div><p><strong>事件载荷示例</strong></p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">window.InstantJS?.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">track</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;PRODUCT_VIEWED&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    provider: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;INSTANT&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    event: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      products: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          product_id: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;prod_456&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          product_sku: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;HOODIE-L-BLACK&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          product_name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;黑色连帽卫衣&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          product_brand: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;UrbanWear&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          variant_id: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;var_789&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          variant_title: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;L码 / 黑色&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          price: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8900</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          currency: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CNY&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          image: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            url: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://example.com/hoodie-black.jpg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            alt: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;黑色连帽卫衣&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          handle: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;black-hoodie&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          online_store_url: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://shop.example.com/products/black-hoodie&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 必须</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]);</span></span></code></pre></div><p><strong>关键参数说明</strong><code>PRODUCT_VIEWED</code> 事件使用 <code>InteractionProduct</code> 类型，其参数与 <code>PAGE_VIEWED</code> 事件中的表格基本一致。但请务必提供更详尽的商品信息，特别是：</p><ul><li><strong><code>variant_id</code> 和 <code>variant_title</code></strong>：如果商品有规格（如尺寸、颜色），必须提供，以确保推荐准确性。</li><li><strong><code>online_store_url</code></strong>：必须提供，这是生成“查看商品”按钮链接的基础。</li></ul><h3 id="item-added-to-cart" tabindex="-1">ITEM_ADDED_TO_CART <a class="header-anchor" href="#item-added-to-cart" aria-label="Permalink to “ITEM_ADDED_TO_CART”">​</a></h3><p>当用户将商品加入购物车时触发。这是<strong>最关键且数据结构最特殊</strong>的事件，请特别注意 <code>cart</code> 和 <code>items</code> 的区别。</p><p><strong>数据结构核心规则</strong>：</p><ul><li><code>cart</code> 对象中的 <code>items</code> 数组：必须包含<strong>加入操作后</strong>，购物车内的<strong>所有商品</strong>（包括原有的和新增的）。</li><li>顶级的 <code>items</code> 数组：应只包含本次<strong>新加入的那一个（或几个）商品项</strong>。</li></ul><p><strong>TypeScript 函数示例</strong></p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * 发送商品加入购物车事件</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> entireCart</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> 加入新商品后，购物车的完整状态</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> addedItems</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> 本次被新加入的一个或多个商品项</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> trackItemAddedToCart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  entireCart</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> InteractionCart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  addedItems</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> InteractionCartItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> eventPayloads</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> InstantEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      provider: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;INSTANT&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      event: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        cart: entireCart,   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 规则1：完整的购物车</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        items: addedItems   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 规则2：仅新增项</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  window.InstantJS?.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">track</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ITEM_ADDED_TO_CART&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, eventPayloads);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 使用示例：在“加入购物车”按钮的回调函数中调用</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// const updatedCart = await api.addToCart(product);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// trackItemAddedToCart(updatedCart, [product]);</span></span></code></pre></div><p><strong>事件载荷示例</strong></p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 场景：购物车原有1件“T恤”，现加入1件“卫衣”</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">window.InstantJS?.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">track</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ITEM_ADDED_TO_CART&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    provider: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;INSTANT&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    event: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      cart: { </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 代表加购后的完整购物车</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        cart_url: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://shop.example.com/cart/abc123&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        currency: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CNY&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        grand_total: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">13800</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        items: [ </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 规则1：包含所有商品（T恤+卫衣）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          { </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 原有商品</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            item_id: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cart_line_1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            product_id: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;prod_123&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            product_name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;纯棉T恤&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            quantity: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            price: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4900</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // ... 其他字段</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          { </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 新加入的商品（也必须出现在这里）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            item_id: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cart_line_2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            product_id: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;prod_456&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            product_name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;黑色连帽卫衣&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            quantity: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 当前总数量为1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            price: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8900</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // ... 其他字段</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      items: [ </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 规则2：仅包含新加入的“卫衣”</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          item_id: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;cart_line_2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 此ID与上方cart.items中的对应</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          product_id: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;prod_456&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          product_name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;黑色连帽卫衣&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          quantity: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 本次加入的数量</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          price: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8900</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          // ... 其他字段</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]);</span></span></code></pre></div><p><strong><code>cart</code> 参数表格 (InteractionCart)</strong></p><table tabindex="0"><thead><tr><th style="text-align:left;">参数名</th><th style="text-align:left;">类型</th><th style="text-align:left;">是否必需</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong><code>cart_url</code></strong></td><td style="text-align:left;"><code>string</code></td><td style="text-align:left;"><strong>是</strong></td><td style="text-align:left;">购物车页面URL。<code>&quot;https://.../cart&quot;</code></td></tr><tr><td style="text-align:left;"><strong><code>items</code></strong></td><td style="text-align:left;"><code>InteractionCartItem[]</code></td><td style="text-align:left;"><strong>是</strong></td><td style="text-align:left;"><strong>购物车中所有商品</strong>的数组。</td></tr><tr><td style="text-align:left;"><code>cart_id</code></td><td style="text-align:left;"><code>string</code></td><td style="text-align:left;">否</td><td style="text-align:left;">购物车会话ID。</td></tr><tr><td style="text-align:left;"><code>grand_total</code></td><td style="text-align:left;"><code>number</code></td><td style="text-align:left;">否</td><td style="text-align:left;">总计金额（单位：分）。</td></tr><tr><td style="text-align:left;"><code>currency</code></td><td style="text-align:left;"><code>string</code></td><td style="text-align:left;">否</td><td style="text-align:left;">货币代码。</td></tr></tbody></table><p><strong><code>items</code> 参数表格 (InteractionCartItem)</strong> 此类型继承自 <code>InteractionProduct</code>，增加了购物车项专属字段。</p><table tabindex="0"><thead><tr><th style="text-align:left;">参数名</th><th style="text-align:left;">类型</th><th style="text-align:left;">是否必需</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong><code>item_id</code></strong></td><td style="text-align:left;"><code>string</code></td><td style="text-align:left;"><strong>是</strong></td><td style="text-align:left;"><strong>购物车行ID</strong>，非产品ID。用于唯一标识购物车中的一行。</td></tr><tr><td style="text-align:left;"><strong><code>quantity</code></strong></td><td style="text-align:left;"><code>number</code></td><td style="text-align:left;"><strong>是</strong></td><td style="text-align:left;">该商品在购物车中的<strong>总数量</strong>。</td></tr><tr><td style="text-align:left;"><code>item_name</code></td><td style="text-align:left;"><code>string</code></td><td style="text-align:left;">否</td><td style="text-align:left;">商品项名称，通常同 <code>product_name</code>。</td></tr><tr><td style="text-align:left;">（继承的所有参数）</td><td style="text-align:left;"></td><td style="text-align:left;"></td><td style="text-align:left;">如 <code>product_id</code>, <code>price</code>, <code>image</code> 等也必须提供。</td></tr></tbody></table><h3 id="cart-viewed" tabindex="-1">CART_VIEWED <a class="header-anchor" href="#cart-viewed" aria-label="Permalink to “CART_VIEWED”">​</a></h3><p>当用户查看购物车页面时触发。</p><p><strong>TypeScript 函数示例</strong></p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> trackCartView</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">currentCart</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> InteractionCart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  window.InstantJS?.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">track</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CART_VIEWED&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    { provider: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;INSTANT&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, event: { cart: currentCart } }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ]);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 使用示例：在购物车页面组件加载时调用</span></span></code></pre></div><p><strong>必需参数</strong>：<code>cart</code> 对象（结构与 <code>ITEM_ADDED_TO_CART</code> 事件中的完全一致），需包含购物车内最新的所有商品信息。</p><h3 id="checkout-started" tabindex="-1">CHECKOUT_STARTED <a class="header-anchor" href="#checkout-started" aria-label="Permalink to “CHECKOUT_STARTED”">​</a></h3><p>当用户开始结算（通常指进入结算页面或点击“去结算”按钮）时触发。这是衡量转化率的关键节点。</p><p><strong>TypeScript 函数示例</strong></p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> trackCheckoutStarted</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">checkoutCart</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> InteractionCart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 确保购物车数据是结算时的最终状态</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  window.InstantJS?.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">track</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;CHECKOUT_STARTED&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    { provider: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;INSTANT&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, event: { cart: checkoutCart } }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ]);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><strong>必需参数</strong>：<code>cart</code> 对象。建议在此事件中提供尽可能准确的金额信息，包括：</p><ul><li><strong><code>grand_total</code></strong>: 订单总计。</li><li><strong><code>discounts</code></strong>: 应用的折扣数组。</li><li><strong><code>shipping_total</code></strong>: 运费。</li><li><strong><code>tax_total</code></strong>: 税费。</li></ul><h3 id="collection-viewed" tabindex="-1">COLLECTION_VIEWED <a class="header-anchor" href="#collection-viewed" aria-label="Permalink to “COLLECTION_VIEWED”">​</a></h3><p>当用户浏览一个商品集合或分类页面时触发。</p><p><strong>TypeScript 函数示例</strong></p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> trackCollectionView</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">collectionProducts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> InteractionProduct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[])</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 通常传入该集合页当前显示的商品列表</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  window.InstantJS?.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">track</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;COLLECTION_VIEWED&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    { provider: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;INSTANT&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, event: { products: collectionProducts } }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ]);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 使用示例：在分类页加载时，传入第一屏的商品列表</span></span></code></pre></div><p><strong>必需参数</strong>：<code>products</code> 数组，应包含该集合下的代表性商品（例如当前页的前20个商品）。每个商品提供 <code>product_id</code>, <code>product_name</code>, <code>image</code>, <code>online_store_url</code> 等核心信息即可。</p><hr><h2 id="实施与测试建议" tabindex="-1">实施与测试建议 <a class="header-anchor" href="#实施与测试建议" aria-label="Permalink to “实施与测试建议”">​</a></h2><ol><li><strong>实施顺序</strong>：建议按 <code>PAGE_VIEWED</code> → <code>PRODUCT_VIEWED</code> → <code>ITEM_ADDED_TO_CART</code> → <code>CART_VIEWED</code> → <code>CHECKOUT_STARTED</code> 的顺序依次实现和测试。</li><li><strong>测试方法</strong>： <ul><li>在浏览器开发者工具的 <strong>Console（控制台）</strong> 中，直接输入 <code>window.InstantJS.track</code> 并回车，检查函数是否存在。</li><li>触发事件后，在 <strong>Network（网络）</strong> 标签页中过滤 <code>instant</code> 请求，查看发送的数据负载。</li><li>验证关键数据： <ul><li><code>cart_url</code> 和商品的 <code>online_store_url</code> 是否为完整URL。</li><li>对于 <code>ITEM_ADDED_TO_CART</code>，检查 <code>cart.items</code> 与顶级 <code>items</code> 数组是否遵循上述规则。</li></ul></li></ul></li></ol><h2 id="通用-typescript-类型参考" tabindex="-1">通用 TypeScript 类型参考 <a class="header-anchor" href="#通用-typescript-类型参考" aria-label="Permalink to “通用 TypeScript 类型参考”">​</a></h2><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 事件类型枚举</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> InteractionType</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;PAGE_VIEWED&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;COLLECTION_VIEWED&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;PRODUCT_VIEWED&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;ITEM_ADDED_TO_CART&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;CART_VIEWED&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;CHECKOUT_STARTED&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Instant 事件载荷类型</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> InstantEvent</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  provider</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;INSTANT&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  event</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    cart</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> InteractionCart</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    items</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> InteractionCartItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[];</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    products</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> InteractionProduct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 其他服务商类型示例（如Klaviyo）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">type</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KlaviyoEvent</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  provider</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;KLAVIYO&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  event</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 请根据Klaviyo官方文档定义具体结构</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 全局窗口类型扩展</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">declare</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> global {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Window</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    InstantJS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      track</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> InteractionType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">body</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">InstantEvent</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> KlaviyoEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)[]) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div>`,70)])])}const o=i(l,[["render",e]]);export{g as __pageData,o as default};
