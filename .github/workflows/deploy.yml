name: Deploy VitePress to GitHub Pages

on:
  push:
    branches:
      - master  # æˆ–è€… masterï¼Œæ ¹æ®ä½ çš„é»˜è®¤åˆ†æ”¯å
  # å…è®¸æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    # å…³é”®ï¼šæ·»åŠ æƒé™é…ç½®
    permissions:
      contents: write  # å…è®¸å†™å…¥ä»“åº“
      pages: write     # å…è®¸å†™å…¥ GitHub Pages
      id-token: write  # å…è®¸ OIDC ä»¤ç‰Œ
      
    steps:
      # 1. æ£€å‡ºä»£ç 
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # è·å–æ‰€æœ‰å†å²ä»¥ä¾¿æ­£ç¡®ç”Ÿæˆ lastUpdated
      
      # 2. è®¾ç½® Node.js ç¯å¢ƒ
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22.21.0'
          cache: 'npm'
      
      # 3. å®‰è£…ä¾èµ–
      - name: Install dependencies
        run: npm install --legacy-peer-deps  # å¼ºåˆ¶å¿½ç•¥ peer ä¾èµ–å†²çª
      
      # 4. æ„å»ºé¡¹ç›®
      - name: Build VitePress
        run: npm run docs:build
        
      # ğŸ”¥ å…³é”®ä¿®å¤ï¼šæ‰‹åŠ¨åˆ›å»º .nojekyll æ–‡ä»¶
      - name: Create .nojekyll file to disable Jekyll
        run: |
          echo "Disabling Jekyll processing" > ./.vitepress/dist/.nojekyll
          echo "âœ… éªŒè¯æ–‡ä»¶å·²åˆ›å»º11:"
          ls -la ./.vitepress/dist/.nojekyll

      # 5. éƒ¨ç½²åˆ° gh-pages åˆ†æ”¯
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          # ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„ tokenï¼Œæ— éœ€é¢å¤–é…ç½®
          github_token: ${{ secrets.GITHUB_TOKEN }}
          
          # å‘å¸ƒç›®å½•ï¼šVitePress æ„å»ºè¾“å‡ºçš„ç›®å½•
          # å¦‚æœåœ¨æ ¹ç›®å½•ï¼Œä½¿ç”¨ï¼š./.vitepress/dist
          publish_dir: ./.vitepress/dist
          
          # å‘å¸ƒåˆ°çš„åˆ†æ”¯
          publish_branch: gh-pages

          # å…³é”®ä¿®å¤
          enable_jekyll: false

          keep_files: false  # æ¯æ¬¡å®Œå…¨æ¸…ç† gh-pages åˆ†æ”¯
          
          # å¯é€‰ï¼šå¦‚æœä¹‹å‰å·²ç»å­˜åœ¨ gh-pages åˆ†æ”¯ï¼Œæ˜¯å¦å¼ºåˆ¶æ¨é€
          force_orphan: true
          
          # å¯é€‰ï¼šæ¯æ¬¡æäº¤çš„ç”¨æˆ·ä¿¡æ¯
          user_name: 'github-actions[bot]'
          user_email: 'github-actions[bot]@users.noreply.github.com'
          
          # å¯é€‰ï¼šæäº¤ä¿¡æ¯
          commit_message: ${{ github.event.head_commit.message }}